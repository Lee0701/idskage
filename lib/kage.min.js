/*! kage.js v0.4.0
 *  Licensed under GPL-3.0
 *  https://github.com/kurgm/kage-engine#readme
 */
var Kage=function(){"use strict";var t=function(){function t(){this.hash={}}return t.prototype.set=function(t,e){this.hash[t]=e},t.prototype.search=function(t){return this.hash[t]?this.hash[t]:""},t.prototype.push=function(t,e){this.set(t,e)},t}(),e=function(){function t(){this.array=[]}return t.prototype.clear=function(){this.array=[]},t.prototype.push=function(t){var e=200,r=0,n=200,o=0;if(!(t.length<3)){t.floor();for(var a=0,i=t.array;a<i.length;a++){var s=i[a],h=s.x,u=s.y;if(h<e&&(e=h),h>r&&(r=h),u<n&&(n=u),u>o&&(o=u),isNaN(h)||isNaN(u))return}e!==r&&n!==o&&this.array.push(t)}},t.prototype.generateSVG=function(t){var e='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" baseProfile="full" viewBox="0 0 200 200" width="200" height="200">\n';if(t)for(var r=0,n=this.array;r<n.length;r++){var o=n[r].array,a="L";e+='<path d="';for(var i=0;i<o.length;i++)0===i?e+="M ":o[i].off?(e+="Q ",a="Q"):"Q"!==a||o[i-1].off?"L"===a&&1===i&&(e+="L "):e+="L ",e+="".concat(o[i].x,",").concat(o[i].y," ");e+='Z" fill="black" />\n'}else e+='<g fill="black">\n',e+=this.array.map((function(t){var e=t.array;return'<polygon points="'.concat(e.map((function(t){var e=t.x,r=t.y;return"".concat(e,",").concat(r," ")})).join(""),'" />\n')})).join(""),e+="</g>\n";return e+="</svg>\n"},t.prototype.generateEPS=function(){var t="";t+="%!PS-Adobe-3.0 EPSF-3.0\n%%BoundingBox: 0 -208 1024 816\n%%Pages: 0\n%%Title: Kanji glyph\n%%Creator: GlyphWiki powered by KAGE system\n%%CreationDate: ".concat((new Date).toString(),"\n%%EndComments\n%%EndProlog\n");for(var e=0,r=this.array;e<r.length;e++){for(var n=r[e].array,o=0;o<n.length;o++)t+="".concat(5*n[o].x," ").concat(1e3-5*n[o].y-200," "),t+=0===o?"newpath\nmoveto\n":"lineto\n";t+="closepath\nfill\n"}return t+="%%EOF\n"},t}();"undefined"!=typeof Symbol&&Symbol.iterator&&(e.prototype[Symbol.iterator]=function(){return this.array[Symbol.iterator]()});var r=Math.hypot?Math.hypot.bind(Math):function(t,e){return Math.sqrt(t*t+e*e)};function n(t,e){var n=t[0],o=t[1];if(void 0===e&&(e=1),0===n&&0===o)return[1/n==1/0?e:-e,0];var a=e/r(n,o);return[n*a,o*a]}function o(t,e,r,n){var o=1-n;return o*o*t+o*n*2*e+n*n*r}function a(t,e,r,n){return 2*(n*(t-2*e+r)-t+e)}function i(t,e,r,n,o){var a=1-o;return a*a*a*t+a*a*o*3*e+a*o*o*3*r+o*o*o*n}function s(t,e,r,n,o){return 3*(o*(o*(3*e-t-3*r+n)+2*(t-2*e+r))-t+e)}function h(t,e,r,n){for(void 0===n&&(n=1e-5);e+n<r;){var o=e+(r-e)/3,a=r-(r-e)/3;t(o)<t(a)?r=a:e=o}return e+(r-e)/2}function u(t,e){return void 0===e&&(e=1e8),Math.round(t*e)/e}function f(t,e,r,n){return t*n-r*e}function k(t,e,r,n,o,a,i,s){var h=f(r-t,n-e,i-o,s-a);if(isNaN(h))return!0;if(0===h)return!1;var k=f(r-t,n-e,o-t,a-e),y=f(r-t,n-e,i-t,s-e),c=f(i-o,s-a,t-o,e-a),p=f(i-o,s-a,r-o,n-a);return u(k*y,1e5)<=0&&u(c*p,1e5)<=0}function y(t,e,r,n,o){var a,i,s,h;return r<e+100?(a=n,s=n,i=e+100,h=t+100):(a=e+100,s=t+100,i=o,h=o),Math.floor((r-a)/(i-a)*(h-s)+s)}var c,p=function(){function t(t){this.a1_100=t[0],this.a2_100=t[1],this.a3_100=t[2],this.x1=t[3],this.y1=t[4],this.x2=t[5],this.y2=t[6],this.x3=t[7],this.y3=t[8],this.x4=t[9],this.y4=t[10],this.a1_opt=Math.floor(this.a1_100/100),this.a1_100%=100,this.a2_opt=Math.floor(this.a2_100/100),this.a2_100%=100,this.a2_opt_1=this.a2_opt%10,this.a2_opt_2=Math.floor(this.a2_opt/10)%10,this.a2_opt_3=Math.floor(this.a2_opt/100),this.a3_opt=Math.floor(this.a3_100/100),this.a3_100%=100,this.a3_opt_1=this.a3_opt%10,this.a3_opt_2=Math.floor(this.a3_opt/10)}return t.prototype.getControlSegments=function(){var t=[];switch(0===this.a1_opt?this.a1_100:1){case 0:case 8:case 9:break;case 6:case 7:t.unshift([this.x3,this.y3,this.x4,this.y4]);case 2:case 12:case 3:case 4:t.unshift([this.x2,this.y2,this.x3,this.y3]);default:t.unshift([this.x1,this.y1,this.x2,this.y2])}return t},t.prototype.isCross=function(t,e,r,n){return this.getControlSegments().some((function(o){return k(o[0],o[1],o[2],o[3],t,e,r,n)}))},t.prototype.isCrossBox=function(t,e,r,n){return this.getControlSegments().some((function(o){return function(t,e,r,n,o,a,i,s){return!!(k(t,e,r,n,o,a,i,a)||k(t,e,r,n,i,a,i,s)||k(t,e,r,n,o,s,i,s)||k(t,e,r,n,o,a,o,s))}(o[0],o[1],o[2],o[3],t,e,r,n)}))},t.prototype.stretch=function(t,e,r,n,o,a,i,s){this.x1=y(t,e,this.x1,o,a),this.y1=y(r,n,this.y1,i,s),this.x2=y(t,e,this.x2,o,a),this.y2=y(r,n,this.y2,i,s),99===this.a1_100&&0===this.a1_opt||(this.x3=y(t,e,this.x3,o,a),this.y3=y(r,n,this.y3,i,s),this.x4=y(t,e,this.x4,o,a),this.y4=y(r,n,this.y4,i,s))},t.prototype.getBox=function(){var t=1/0,e=1/0,r=-1/0,n=-1/0;switch(0===this.a1_opt?this.a1_100:6){default:t=Math.min(t,this.x4),r=Math.max(r,this.x4),e=Math.min(e,this.y4),n=Math.max(n,this.y4);case 2:case 3:case 4:t=Math.min(t,this.x3),r=Math.max(r,this.x3),e=Math.min(e,this.y3),n=Math.max(n,this.y3);case 1:case 99:t=Math.min(t,this.x1,this.x2),r=Math.max(r,this.x1,this.x2),e=Math.min(e,this.y1,this.y2),n=Math.max(n,this.y1,this.y2);case 0:}return{minX:t,maxX:r,minY:e,maxY:n}},t}();function x(t,e,r,n,o,a,i){var s=Math.floor(.5*i.length),h=s/i.length,u=t+(r-t)*h,f=e+(n-e)*h,k=r+(o-r)*h,y=n+(a-n)*h,c=u+(k-u)*h,p=f+(y-f)*h;return{index:s,off:[[t,e,u,f,c,p],[c,p,k,y,o,a]]}}function g(t,e,r){var n=t[0],a=n[0],i=n[1],s=t[t.length-1],u=s[0],f=s[1],k=h((function(e){return t.reduce((function(r,n,i){var s=i/(t.length-1),h=o(a,e,u,s);return r+Math.pow(n[0]-h,2)}),0)}),e-8,e+8),y=h((function(e){return t.reduce((function(r,n,a){var s=a/(t.length-1),h=o(i,e,f,s);return r+Math.pow(n[1]-h,2)}),0)}),r-8,r+8);return[a,i,k,y,u,f]}function d(t,e,r,h,u,f,k,y,c,p,x){void 0===x&&(x=n);var g,d,l,M,v={left:[],right:[]};r===u&&h===f?(g=function(e){return o(t,r,k,e)},d=function(t){return o(e,h,y,t)},l=function(e){return a(t,r,k,e)},M=function(t){return a(e,h,y,t)}):(g=function(e){return i(t,r,u,k,e)},d=function(t){return i(e,h,f,y,t)},l=function(e){return s(t,r,u,k,e)},M=function(t){return s(e,h,f,y,t)});for(var _=0;_<=1e3;_+=c){var j=_/1e3,m=g(j),P=d(j),w=l(j),W=x([-M(j),w],p(j)),A=W[0],b=W[1];v.left.push([m-A,P-b]),v.right.push([m+A,P+b])}return v}!function(t){t[t.kMincho=0]="kMincho",t[t.kGothic=1]="kGothic"}(c||(c={}));var l=function(){function t(t){if(this._precision=10,this._array=[],t)if("number"==typeof t)for(var e=0;e<t;e++)this.push(0,0,!1);else for(var r=0,n=t;r<n.length;r++){var o=n[r],a=o.x,i=o.y,s=o.off;this.push(a,i,s)}}return Object.defineProperty(t.prototype,"array",{get:function(){var t=this;return this._array.map((function(e,r){return t.get(r)}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._array.length},enumerable:!1,configurable:!0}),t.prototype.push=function(t,e,r){void 0===r&&(r=!1),this._array.push(this.createInternalPoint(t,e,r))},t.prototype.pushPoint=function(t){this.push(t.x,t.y,t.off)},t.prototype.set=function(t,e,r,n){void 0===n&&(n=!1),this._array[t]=this.createInternalPoint(e,r,n)},t.prototype.setPoint=function(t,e){this.set(t,e.x,e.y,e.off)},t.prototype.get=function(t){var e=this._array[t],r=e.x,n=e.y,o=e.off;return 0===this._precision?{x:r,y:n,off:o}:{x:r/this._precision,y:n/this._precision,off:o}},t.prototype.reverse=function(){this._array.reverse()},t.prototype.concat=function(t){if(this._precision!==t._precision)throw new TypeError("Cannot concat polygon's with different precisions");this._array=this._array.concat(t._array)},t.prototype.shift=function(){this._array.shift()},t.prototype.unshift=function(t,e,r){void 0===r&&(r=!1),this._array.unshift(this.createInternalPoint(t,e,r))},t.prototype.clone=function(){return new t(this.array)},t.prototype.createInternalPoint=function(t,e,r){return void 0===r&&(r=!1),0===this._precision?{x:t,y:e,off:r}:{x:t*this._precision,y:e*this._precision,off:r}},t.prototype.translate=function(t,e){0!==this._precision&&(t*=this._precision,e*=this._precision);for(var r=0,n=this._array;r<n.length;r++){var o=n[r];o.x+=t,o.y+=e}return this},t.prototype.reflectX=function(){for(var t=0,e=this._array;t<e.length;t++){e[t].x*=-1}return this},t.prototype.reflectY=function(){for(var t=0,e=this._array;t<e.length;t++){e[t].y*=-1}return this},t.prototype.rotate90=function(){for(var t=0,e=this._array;t<e.length;t++){var r=e[t],n=r.x,o=r.y;r.x=-o,r.y=n}return this},t.prototype.rotate180=function(){for(var t=0,e=this._array;t<e.length;t++){var r=e[t];r.x*=-1,r.y*=-1}return this},t.prototype.rotate270=function(){for(var t=0,e=this._array;t<e.length;t++){var r=e[t],n=r.x,o=r.y;r.x=o,r.y=-n}return this},t.prototype.floor=function(){if(0===this._precision)return this;for(var t=0,e=this._array;t<e.length;t++){var r=e[t],n=r.x,o=r.y;r.x=Math.floor(n),r.y=Math.floor(o)}return this},t}();"undefined"!=typeof Symbol&&Symbol.iterator&&(l.prototype[Symbol.iterator]=function(){var t=this,e=0;return{next:function(){return e<t._array.length?{done:!1,value:t.get(e++)}:{done:!0,value:void 0}}}});var M=function(){function t(t,e){this.cos_theta=1,this.sin_theta=0,this.x=t,this.y=e}return t.prototype.setMatrix2=function(t,e){return this.cos_theta=t,this.sin_theta=e,this},t.prototype.setLeft=function(t,e){var r=n([t-this.x,e-this.y]),o=r[0],a=r[1];return this.setMatrix2(-o,-a),this},t.prototype.setRight=function(t,e){var r=n([t-this.x,e-this.y]),o=r[0],a=r[1];return this.setMatrix2(o,a),this},t.prototype.setUp=function(t,e){var r=n([t-this.x,e-this.y]),o=r[0],a=r[1];return this.setMatrix2(-a,o),this},t.prototype.setDown=function(t,e){var r=n([t-this.x,e-this.y]),o=r[0],a=r[1];return this.setMatrix2(a,-o),this},t.prototype.move=function(t,e){var r;return r=this.getPoint(t,e),this.x=r.x,this.y=r.y,this},t.prototype.getPoint=function(t,e,r){return{x:this.x+this.cos_theta*t+-this.sin_theta*e,y:this.y+this.sin_theta*t+this.cos_theta*e,off:r}},t.prototype.getPolygon=function(t){var e=this;return new l(t.map((function(t){var r=t.x,n=t.y,o=t.off;return e.getPoint(r,n,o)})))},t}();function v(t,e,o,a,i,s,h,f,k,y,c,p,v,_,j,m){var P,w=c,W=p,A=t.kMinWidthT-v/2;switch(w%100){case 0:case 7:case 27:P=-1*t.kMinWidthY*.5;break;case 1:case 2:case 6:case 22:case 32:P=0;break;case 12:P=t.kMinWidthY;break;default:return}if(0!==P){var b=o===i&&a===s?[0,P]:n([o-i,a-s],P);o+=b[0],a+=b[1]}var Y,S=0;if((22===w||27===w)&&7===W&&A>6){var U=r(i-o,s-a)+r(h-i,f-s)+r(k-h,y-f);U<100&&(o+=S=(100-U)/100*(A-6))}switch(W%100){case 0:case 1:case 7:case 9:case 15:case 14:case 17:case 5:Y=0;break;case 8:Y=-1*A*.5;break;default:Y=P}if(0!==Y){var L=h===k&&f===y?[0,-Y]:n([k-h,y-f],Y);k+=L[0],y+=L[1]}var K=i===h&&s===f;if(K&&t.kUseCurve){var T=7===w&&0===W?function(t){return 1.1*Math.pow(t,.5)}:7===w?function(t){return Math.pow(t,.5)}:7===W?function(t){return Math.pow(1-t,.5)}:j>0?function(t){return 1-j/2/(A-m/2)+j/2/(A-m)*t}:function(){return 1},R=d(o,a,i,s,i,s,k,y,10,(function(t){var e=T(t);return e<.15&&(e=.15),A*e}),(function(t,e){var r=t[0],o=t[1];return 0===o?[-e,0]:n([r,o],e)})),C=R.left,D=R.right,X=x(o,a,i,s,k,y,C),B=X.off,E=B[0],G=B[1],O=X.index,F=C.slice(0,O+1),I=C.slice(O),N=x(o,a,i,s,k,y,D),z=N.off,Q=z[0],H=z[1],q=N.index,V=g(F,E[2],E[3]),Z=g(I,G[2],G[3]),$=new l([{x:V[0],y:V[1]},{x:V[2],y:V[3],off:!0},{x:V[4],y:V[5]},{x:Z[2],y:Z[3],off:!0},{x:Z[4],y:Z[5]}]);(ot=new l([{x:D[0][0],y:D[0][1]},{x:Q[2]-(V[2]-E[2]),y:Q[3]-(V[3]-E[3]),off:!0},{x:D[q][0],y:D[q][1]},{x:H[2]-(Z[2]-G[2]),y:H[3]-(Z[3]-G[3]),off:!0},{x:D[D.length-1][0],y:D[D.length-1][1]}])).reverse(),$.concat(ot),e.push($)}else{var J=.5;r(k-o,y-a)<50&&(J+=.4*(1-r(k-o,y-a)/50));for(var tt=7!==w&&27!==w||0!==W?7===w||27===w?K?function(t){return Math.pow(t,J)}:function(t){return Math.pow(Math.pow(t,J),.7)}:7===W?function(t){return Math.pow(1-t,J)}:K&&(j>0||m>0)?function(e){return(t.kMinWidthT-j/2-(m-j)/2*e)/t.kMinWidthT}:function(){return 1}:function(e){return Math.pow(e,J)*t.kL2RDfatten},et=d(o,a,i,s,h,f,k,y,t.kRate,(function(t){var e=tt(t);return e<.15&&(e=.15),A*e}),(function(t,e){var r=t[0],o=t[1];return 0===u(r)&&0===u(o)?[-e,0]:n([r,o],e)})),rt=et.left,nt=et.right,ot=($=new l,new l),at=0,it=rt;at<it.length;at++){var st=it[at],ht=st[0],ut=st[1];$.push(ht,ut)}for(var ft=0,kt=nt;ft<kt.length;ft++){var yt=kt[ft];ht=yt[0],ut=yt[1];ot.push(ht,ut)}if(132===w||22===w&&(K?a>y:o>i)){$.floor(),ot.floor();for(var ct=0,pt=ot.length;ct+1<pt;ct++){var xt=ot.get(ct),gt=ot.get(ct+1);if(xt.y<=a&&a<=gt.y){for(var dt=gt.x+(xt.x-gt.x)*(a-gt.y)/(xt.y-gt.y),lt=a,Mt=$.get(0),vt=$.get(1),_t=132===w?Mt.x+(vt.x-Mt.x)*(a-Mt.y)/(vt.y-Mt.y):Mt.x+(vt.x-Mt.x+1)*(a-Mt.y)/(vt.y-Mt.y),jt=132===w?a:a+1,mt=0;mt<ct;mt++)ot.shift();ot.set(0,dt,lt),$.unshift(_t,jt);break}}}ot.reverse(),$.concat(ot),e.push($)}switch(w){case 12:var Pt=new M(o,a);o!==i&&Pt.setDown(i,s);$=Pt.getPolygon([{x:-A,y:0},{x:+A,y:0},{x:-A,y:-A}]);e.push($);break;case 0:if(a<=y){Pt=new M(o,a);o!==i&&Pt.setDown(i,s);var wt=Math.atan2(Math.abs(a-s),Math.abs(o-i))/Math.PI*2-.4,Wt=(wt*=wt>0?2:16)<0?-1:1;$=Pt.getPolygon([{x:-A,y:1},{x:+A,y:0},{x:-Wt*A,y:-t.kMinWidthY*Math.abs(wt)}]);e.push($);var At=wt<0?-wt*t.kMinWidthY:0;ot=Pt.getPolygon(o===i&&a===s?[{x:A,y:-At},{x:1.5*A,y:t.kMinWidthY-At},{x:A-2,y:2*t.kMinWidthY+1}]:[{x:A,y:-At},{x:1.5*A,y:t.kMinWidthY-1.2*At},{x:A-2,y:2*t.kMinWidthY-.8*At+1}]);e.push(ot)}else{Pt=new M(o,a);o===i?Pt.setMatrix2(0,1):Pt.setRight(i,s);$=Pt.getPolygon([{x:0,y:+A},{x:0,y:-A},{x:-t.kMinWidthY,y:-A}]);e.push($);ot=Pt.getPolygon([{x:0,y:+A},{x:+t.kMinWidthY,y:1.5*+A},{x:3*+t.kMinWidthY,y:.5*+A}]);e.push(ot)}break;case 22:case 27:$=new M(o-S,a).getPolygon([{x:-A,y:-t.kMinWidthY},{x:0,y:-t.kMinWidthY-t.kWidth},{x:+A+t.kWidth,y:+t.kMinWidthY},{x:+A,y:+A-1}].concat(27===w?[{x:0,y:+A+2},{x:0,y:0}]:[{x:-A,y:+A+4}]));e.push($)}switch(W){case 1:case 8:case 15:var bt=t.kMinWidthT-m/2,Yt=new M(k,y);h===k?Yt.setMatrix2(0,1):f!==y&&Yt.setLeft(h,f);$=Yt.getPolygon(t.kUseCurve?[{x:0,y:-bt},{x:.9*+bt,y:.9*-bt,off:!0},{x:+bt,y:0},{x:.9*+bt,y:.9*+bt,off:!0},{x:0,y:+bt}]:[{x:0,y:-bt},{x:.7*+bt,y:.7*-bt},{x:+bt,y:0},{x:.7*+bt,y:.7*+bt},{x:0,y:+bt}]);if(h===k&&$.reverse(),e.push($),15===W){var St=new M(k,y);a>=y&&St.setMatrix2(-1,0);var Ut=St.getPolygon([{x:0,y:1-A},{x:2,y:-A-5*t.kWidth},{x:0,y:-A-5*t.kWidth},{x:-A,y:1-A}]);e.push(Ut)}break;case 0:if(7!==w&&27!==w)break;case 9:wt=Math.atan2(Math.abs(y-f),Math.abs(k-h))/Math.PI*2-.6,Wt=(wt*=wt>0?8:3)<0?-1:1,Yt=new M(k,y);f===y?Yt.setMatrix2(1,0):h===k?Yt.setMatrix2(0,y>f?-1:1):Yt.setLeft(h,f);$=Yt.getPolygon([{x:0,y:+A*t.kL2RDfatten},{x:0,y:-A*t.kL2RDfatten},{x:Math.abs(wt)*A*t.kL2RDfatten,y:Wt*A*t.kL2RDfatten}]);e.push($);break;case 14:var Lt=A>6?6/A:1,Kt=4*t.kWidth*Math.min(1-_/10,Math.pow(A/t.kMinWidthT,3))*Lt;$=new M(k,y).getPolygon([{x:0,y:0},{x:0,y:-A},{x:-Kt,y:-A},{x:-Kt,y:.5*-A}]);e.push($)}}function _(t,e,r,n,o,a,i,s,h,u,f,k,y,c,p,x){v(t,e,r,n,o,a,i,s,h,u,f,k,y,c,p,x)}function j(t,e,r,n,o,a,i,s,h,u,f,k,y,c){v(t,e,r,n,o,a,o,a,i,s,h,u,f,k,y,c)}function m(t,e,r,o,a,i,s,h,u,f,k){var y=r,c=o,p=a,x=i,g=s,d=h,v=t.kMinWidthT-u/2;if(y===p||c!==x&&(y>p||Math.abs(x-c)>=Math.abs(p-y)||6===g||6===d)){var _=y===p?[0,1]:n([p-y,x-c]),j=_[0],m=_[1],P=new M(y,c),w=new M(p,x);P.setMatrix2(m,-j),w.setMatrix2(m,-j);var W=new l(4);switch(g){case 0:W.setPoint(0,P.getPoint(v,t.kMinWidthY/2)),W.setPoint(3,P.getPoint(-v,-t.kMinWidthY/2));break;case 1:case 6:W.setPoint(0,P.getPoint(v,0)),W.setPoint(3,P.getPoint(-v,0));break;case 12:W.setPoint(0,P.getPoint(v,-t.kMinWidthY)),W.setPoint(3,P.getPoint(-v,-t.kMinWidthY-v));break;case 22:if(y===p)W.set(0,y+v,c),W.set(3,y-v,c);else{var A=y>p?-1:1;W.set(0,y+(v+A)/m,c+1),W.set(3,y-v/m,c)}break;case 32:y===p?(W.set(0,y+v,c-t.kMinWidthY),W.set(3,y-v,c-t.kMinWidthY)):(W.set(0,y+v/m,c),W.set(3,y-v/m,c))}switch(d){case 0:6===g?(W.setPoint(1,w.getPoint(v,0)),W.setPoint(2,w.getPoint(-v,0))):(W.setPoint(1,w.getPoint(v,-v/2)),W.setPoint(2,w.getPoint(-v,v/2)));break;case 5:if(y===p)break;case 1:W.setPoint(1,w.getPoint(v,0)),W.setPoint(2,w.getPoint(-v,0));break;case 13:W.setPoint(1,w.getPoint(v,t.kAdjustKakatoL[k])),W.setPoint(2,w.getPoint(-v,t.kAdjustKakatoL[k]+v));break;case 23:W.setPoint(1,w.getPoint(v,t.kAdjustKakatoR[k])),W.setPoint(2,w.getPoint(-v,t.kAdjustKakatoR[k]+v));break;case 24:case 32:y===p?(W.set(1,p+v,x+t.kMinWidthY),W.set(2,p-v,x+t.kMinWidthY)):(W.set(1,p+v/m,x),W.set(2,p-v/m,x))}switch(e.push(W),d){case 24:var b=new M(p,x).getPolygon([{x:0,y:+t.kMinWidthY},y===p?{x:+v,y:3*-t.kMinWidthY}:{x:.5*+v,y:4*-t.kMinWidthY},{x:2*+v,y:-t.kMinWidthY},{x:2*+v,y:+t.kMinWidthY}]);e.push(b);break;case 13:if(4===k)if(y===p){b=new M(p,x).getPolygon([{x:-v,y:3*-t.kMinWidthY},{x:2*-v,y:0},{x:-t.kMinWidthY,y:5*+t.kMinWidthY},{x:+v,y:+t.kMinWidthY}]);e.push(b)}else{var Y=y>p&&c!==x?Math.floor((y-p)/(x-c)*3):0;b=new M(p+Y,x).getPolygon([{x:0,y:5*-t.kMinWidthY},{x:2*-v,y:0},{x:-t.kMinWidthY,y:5*+t.kMinWidthY},{x:+v,y:+t.kMinWidthY},{x:0,y:0}]);e.push(b)}}switch(g){case 22:case 27:b=new M(y,c).getPolygon([{x:-v,y:-t.kMinWidthY},{x:0,y:-t.kMinWidthY-t.kWidth},{x:+v+t.kWidth,y:+t.kMinWidthY}].concat(y===p?[{x:+v,y:+v},{x:-v,y:0}]:27===g?[{x:+v,y:+v-1},{x:0,y:+v+2},{x:0,y:0}]:[{x:+v,y:+v-1},{x:-v,y:+v+4}]));e.push(b);break;case 0:b=P.getPolygon([{x:v,y:.5*t.kMinWidthY},{x:v+.5*v,y:.5*t.kMinWidthY+t.kMinWidthY},{x:v-2,y:.5*t.kMinWidthY+2*t.kMinWidthY+1}]);y!==p&&b.set(2,y+(v-2)*m+(.5*t.kMinWidthY+2*t.kMinWidthY)*j,c+(v+1)*-j+(.5*t.kMinWidthY+2*t.kMinWidthY)*m),e.push(b)}if(y===p&&1===d||6===g&&(0===d||y!==p&&5===d)){b=new l;if(t.kUseCurve)b.pushPoint(w.getPoint(v,0)),b.push(p-j*v*.9+-m*-v*.9,x+m*v*.9+j*-v*.9,!0),b.pushPoint(w.getPoint(0,v)),b.pushPoint(w.getPoint(.9*-v,.9*v,!0)),b.pushPoint(w.getPoint(-v,0));else{var S=y===p&&(6===g&&0===d||1===d)?.6:.8;b.pushPoint(w.getPoint(v,0)),b.pushPoint(w.getPoint(.6*v,v*S)),b.pushPoint(w.getPoint(0,v)),b.pushPoint(w.getPoint(.6*-v,v*S)),b.pushPoint(w.getPoint(-v,0))}if(y===p&&(6===g&&0===d||1===d)&&b.reverse(),e.push(b),y!==p&&6===g&&5===d){var U=5*t.kWidth,L=y<p?1:-1,K=w.getPolygon([{x:L*(v-1),y:0},{x:L*(v+U),y:2},{x:L*(v+U),y:0},{x:v-1,y:-v}]);e.push(K)}}}else if(c===x&&6===g){var T=new M(y,c),R=new M(p,x);W=new l([T.getPoint(0,-v),R.getPoint(0,-v),R.getPoint(0,+v),T.getPoint(0,+v)]);switch(e.push(W),d){case 1:case 0:case 5:w=new M(p,x);y>p&&w.setMatrix2(-1,0);S=.6,b=w.getPolygon(t.kUseCurve?[{x:0,y:-v},{x:.9*+v,y:.9*-v,off:!0},{x:+v,y:0},{x:.9*+v,y:.9*+v,off:!0},{x:0,y:+v}]:[{x:0,y:-v},{x:+v*S,y:.6*-v},{x:+v,y:0},{x:+v*S,y:.6*+v},{x:0,y:+v}]);if(y>=p&&b.reverse(),e.push(b),5===d){U=t.kWidth*(4*(1-u/t.kAdjustMageStep)+1),L=y<p?1:-1;var C=w.getPolygon([{x:0,y:L*-v},{x:2,y:L*(-v-U)},{x:0,y:L*(-v-U)},{x:-v,y:L*-v}]);e.push(C)}}}else{var D=c===x?[1,0]:n([p-y,x-c]);j=D[0],m=D[1],P=new M(y,c),w=new M(p,x);P.setMatrix2(j,m),w.setMatrix2(j,m);b=new l([P.getPoint(0,-t.kMinWidthY),w.getPoint(0,-t.kMinWidthY),w.getPoint(0,t.kMinWidthY),P.getPoint(0,t.kMinWidthY)]);if(e.push(b),0===d){var X=(t.kMinWidthU/t.kMinWidthY-1)/4+1,B=w.getPolygon([{x:0,y:-t.kMinWidthY},{x:-t.kAdjustUrokoX[f]*X,y:0}]);B.push(p-(j-m)*t.kAdjustUrokoX[f]*X/2,x-(m+j)*t.kAdjustUrokoY[f]*X),e.push(B)}}}function P(t,e,r,n,o){return t.array.filter((function(t){return t.array.every((function(t){var a=t.x,i=t.y;return e<=a&&a<=n&&r<=i&&i<=o}))}))}var w=function(){function t(){this.shotai=c.kMincho,this.kRate=100,this.setSize()}return t.prototype.setSize=function(t){1===t?(this.kMinWidthY=1.2,this.kMinWidthT=3.6,this.kWidth=3,this.kKakato=1.8,this.kL2RDfatten=1.1,this.kMage=6,this.kUseCurve=!1,this.kAdjustKakatoL=[8,5,3,1,0],this.kAdjustKakatoR=[4,3,2,1],this.kAdjustKakatoRangeX=12,this.kAdjustKakatoRangeY=[1,11,14,18],this.kAdjustKakatoStep=3,this.kAdjustUrokoX=[14,12,9,7],this.kAdjustUrokoY=[7,6,5,4],this.kAdjustUrokoLength=[13,21,30],this.kAdjustUrokoLengthStep=3,this.kAdjustUrokoLine=[13,15,18]):(this.kMinWidthY=2,this.kMinWidthU=2,this.kMinWidthT=6,this.kWidth=5,this.kKakato=3,this.kL2RDfatten=1.1,this.kMage=10,this.kUseCurve=!1,this.kAdjustKakatoL=[14,9,5,2,0],this.kAdjustKakatoR=[8,6,4,2],this.kAdjustKakatoRangeX=20,this.kAdjustKakatoRangeY=[1,19,24,30],this.kAdjustKakatoStep=3,this.kAdjustUrokoX=[24,20,16,12],this.kAdjustUrokoY=[12,11,9,8],this.kAdjustUrokoLength=[22,36,50],this.kAdjustUrokoLengthStep=3,this.kAdjustUrokoLine=[22,26,30],this.kAdjustUroko2Step=3,this.kAdjustUroko2Length=40,this.kAdjustTateStep=4,this.kAdjustMageStep=5)},t.prototype.getDrawers=function(t){var e=this;return this.adjustStrokes(t).map((function(t){return function(o){!function(t,e,o){var a=o.stroke,i=a.a1_100,s=a.a2_100,h=a.a2_opt,u=a.a2_opt_1,f=a.a2_opt_2,k=a.a2_opt_3,y=a.a3_100,c=a.a3_opt,p=a.a3_opt_1,x=a.a3_opt_2,g=a.x1,d=a.y1,l=a.x2,M=a.y2,v=a.x3,w=a.y3,W=a.x4,A=a.y4,b=o.kirikuchiAdjustment,Y=o.tateAdjustment,S=o.haneAdjustment,U=o.urokoAdjustment,L=o.kakatoAdjustment,K=o.mageAdjustment;switch(i){case 0:if(98===s&&0===h)for(var T=g+l,R=0,C=0,D=P(e,g,d,l,M);C<D.length;C++)D[C].reflectX().translate(T,R).floor();else if(97===s&&0===h){T=0,R=d+M;for(var X=0,B=P(e,g,d,l,M);X<B.length;X++)B[X].reflectY().translate(T,R).floor()}else if(99===s&&0===h)if(1===y&&0===c){T=g+M,R=d-g;for(var E=0,G=P(e,g,d,l,M);E<G.length;E++)G[E].rotate90().translate(T,R).floor()}else if(2===y&&0===c){T=g+l,R=d+M;for(var O=0,F=P(e,g,d,l,M);O<F.length;O++)F[O].rotate180().translate(T,R).floor()}else if(3===y&&0===c){T=g-d,R=M+g;for(var I=0,N=P(e,g,d,l,M);I<N.length;I++)N[I].rotate270().translate(T,R).floor()}break;case 1:if(4===y){var z=g===l&&d===M?[0,t.kMage]:n([g-l,d-M],t.kMage);m(t,e,g,d,q=l+z[0],V=M+z[1],s+100*u,1,Y,0,0),j(t,e,q,V,l,M,l-t.kMage*((t.kAdjustTateStep+4-Y)/(t.kAdjustTateStep+4)),M,1,14,Y%10,S,Math.floor(Y/10),x)}else m(t,e,g,d,l,M,s+100*u,y,Y,U,L);break;case 2:if(4===y){var Q=l===v?[0,-t.kMage]:M===w?[-t.kMage,0]:n([l-v,M-w],t.kMage);j(t,e,g,d,l,M,q=v+Q[0],V=w+Q[1],s+100*b,0,f,0,k,0),j(t,e,q,V,v,w,v-t.kMage,w,2,14,f,S,0,x)}else j(t,e,g,d,l,M,v,w,s+100*b,5===y&&0===c?15:y,f,p,k,x);break;case 3:var H=g===l&&d===M?[0,t.kMage]:n([g-l,d-M],t.kMage),q=l+H[0],V=M+H[1],Z=l===v&&M===w?[0,-t.kMage]:n([v-l,w-M],t.kMage),$=l+Z[0],J=M+Z[1];if(m(t,e,g,d,q,V,s+100*u,1,Y,0,0),j(t,e,q,V,l,M,$,J,1,1,0,0,Y,K),5!==y||0!==p||l<v&&v-$>0||l>v&&$-v>0){var tt=5===y&&0===p?0:p+10*K;m(t,e,$,J,v,w,6,y,K,tt,tt)}break;case 12:j(t,e,g,d,l,M,v,w,s+100*u,1,f,0,k,0),m(t,e,v,w,W,A,6,y,0,c,c);break;case 4:var et=r(v-l,w-M)/120*6;et>6&&(et=6);var rt=g===l&&d===M?[0,t.kMage*et]:n([g-l,d-M],t.kMage*et),nt=(q=l+rt[0],V=M+rt[1],l===v&&M===w?[0,-t.kMage*et]:n([v-l,w-M],t.kMage*et));$=l+nt[0],J=M+nt[1],m(t,e,g,d,q,V,s+100*u,1,f+10*k,0,0),j(t,e,q,V,l,M,$,J,1,1,0,0,0,0),5===y&&0===c&&v-$<=0||m(t,e,$,J,v,w,6,y,0,c,c);break;case 6:if(4===y){var ot=v===W?[0,-t.kMage]:w===A?[-t.kMage,0]:n([v-W,w-A],t.kMage);_(t,e,g,d,l,M,v,w,q=W+ot[0],V=A+ot[1],s+100*u,1,f,0,k,0),j(t,e,q,V,W,A,W-t.kMage,A,1,14,0,S,0,x)}else _(t,e,g,d,l,M,v,w,W,A,s+100*u,5===y&&0===c?15:y,f,p,k,x);break;case 7:m(t,e,g,d,l,M,s+100*u,1,Y,0,0),j(t,e,l,M,v,w,W,A,1,y,Y%10,p,Math.floor(Y/10),x)}}(e,o,t)}}))},t.prototype.adjustStrokes=function(t){var e=t.map((function(t){var e=t.a2_opt_1,r=t.a2_opt_2,n=t.a2_opt_3,o=t.a3_opt;return{stroke:t,kirikuchiAdjustment:e,tateAdjustment:r+10*n,haneAdjustment:t.a3_opt_1,urokoAdjustment:o,kakatoAdjustment:o,mageAdjustment:t.a3_opt_2}}));return this.adjustHane(e),this.adjustMage(e),this.adjustTate(e),this.adjustKakato(e),this.adjustUroko(e),this.adjustUroko2(e),this.adjustKirikuchi(e),e},t.prototype.adjustHane=function(t){for(var e=[],r=0,n=t;r<n.length;r++){1===(i=n[r].stroke).a1_100&&0===i.a1_opt&&i.x1===i.x2&&e.push({stroke:i,x:i.x1,y1:i.y1,y2:i.y2})}for(var o=0,a=t;o<a.length;o++){var i,s=a[o];if((1===(i=s.stroke).a1_100||2===i.a1_100||6===i.a1_100)&&0===i.a1_opt&&4===i.a3_100&&0===i.a3_opt){var h=void 0,u=void 0;1===i.a1_100?(h=i.x2,u=i.y2):2===i.a1_100?(h=i.x3,u=i.y3):(h=i.x4,u=i.y4);var f=1/0;h+18<100&&(f=h+18);for(var k=0,y=e;k<y.length;k++){var c=y[k],p=c.stroke,x=c.x,g=c.y1,d=c.y2;i!==p&&h-x<100&&x<h&&g<=u&&d>=u&&(f=Math.min(f,h-x))}f!==1/0&&(s.haneAdjustment+=7-Math.floor(f/15))}}return t},t.prototype.adjustMage=function(t){for(var e=[],r=0,n=t;r<n.length;r++){1===(h=(s=n[r]).stroke).a1_100&&0===h.a1_opt&&h.y1===h.y2?e.push({stroke:h,adjStroke:s,isTarget:!1,y:h.y2,x1:h.x1,x2:h.x2}):3===h.a1_100&&0===h.a1_opt&&h.y2===h.y3&&e.push({stroke:h,adjStroke:s,isTarget:!0,y:h.y2,x1:h.x2,x2:h.x3})}for(var o=0,a=e;o<a.length;o++){var i=a[o],s=i.adjStroke,h=i.stroke,f=i.isTarget,k=i.y,y=i.x1,c=i.x2;if(f)for(var p=0,x=e;p<x.length;p++){var g=x[p],d=g.stroke,l=g.y,M=g.x1,v=g.x2;h!==d&&!(y+1>v||c-1<M)&&u(Math.abs(k-l))<this.kMinWidthT*this.kAdjustMageStep&&(s.mageAdjustment+=this.kAdjustMageStep-Math.floor(Math.abs(k-l)/this.kMinWidthT),s.mageAdjustment>this.kAdjustMageStep&&(s.mageAdjustment=this.kAdjustMageStep))}}return t},t.prototype.adjustTate=function(t){for(var e=[],r=0,n=t;r<n.length;r++){1!==(h=(s=n[r]).stroke).a1_100&&3!==h.a1_100&&7!==h.a1_100||0!==h.a1_opt||h.x1!==h.x2||e.push({stroke:h,adjStroke:s,x:h.x1,y1:h.y1,y2:h.y2})}for(var o=0,a=e;o<a.length;o++)for(var i=a[o],s=i.adjStroke,h=i.stroke,f=i.x,k=i.y1,y=i.y2,c=0,p=e;c<p.length;c++){var x=p[c],g=x.stroke,d=x.x,l=x.y1,M=x.y2;h!==g&&!(k+1>M||y-1<l)&&u(Math.abs(f-d))<this.kMinWidthT*this.kAdjustTateStep&&(s.tateAdjustment+=this.kAdjustTateStep-Math.floor(Math.abs(f-d)/this.kMinWidthT),(s.tateAdjustment>this.kAdjustTateStep||s.tateAdjustment===this.kAdjustTateStep&&(0!==h.a2_opt_1||0!==h.a2_100))&&(s.tateAdjustment=this.kAdjustTateStep))}return t},t.prototype.adjustKakato=function(t){for(var e=this,r=function(r){var o=r.stroke;if(1===o.a1_100&&0===o.a1_opt&&(13===o.a3_100||23===o.a3_100)&&0===o.a3_opt)for(var a=function(a){if(t.some((function(t){var r=t.stroke;return o!==r&&r.isCrossBox(o.x2-e.kAdjustKakatoRangeX/2,o.y2+e.kAdjustKakatoRangeY[a],o.x2+e.kAdjustKakatoRangeX/2,o.y2+e.kAdjustKakatoRangeY[a+1])}))||u(o.y2+n.kAdjustKakatoRangeY[a+1])>200||u(o.y2-o.y1)<n.kAdjustKakatoRangeY[a+1])return r.kakatoAdjustment=3-a,"break"},i=0;i<n.kAdjustKakatoStep;i++){if("break"===a(i))break}},n=this,o=0,a=t;o<a.length;o++){r(a[o])}return t},t.prototype.adjustUroko=function(t){for(var e=function(e){var a=e.stroke;if(1===a.a1_100&&0===a.a1_opt&&0===a.a3_100&&0===a.a3_opt)for(var i=function(i){var s=a.y1===a.y2?[1,0]:a.x2-a.x1<0?n([a.x1-a.x2,a.y1-a.y2]):n([a.x2-a.x1,a.y2-a.y1]),h=s[0],f=s[1],k=a.x2-o.kAdjustUrokoLine[i]*h-.5*f,y=a.y2-o.kAdjustUrokoLine[i]*f-.5*h;if(u(a.y1===a.y2?a.x2-a.x1:r(a.y2-a.y1,a.x2-a.x1))<o.kAdjustUrokoLength[i]||t.some((function(t){var e=t.stroke;return a!==e&&e.isCross(k,y,a.x2,a.y2)})))return e.urokoAdjustment=o.kAdjustUrokoLengthStep-i,"break"},s=0;s<o.kAdjustUrokoLengthStep;s++){if("break"===i(s))break}},o=this,a=0,i=t;a<i.length;a++){e(i[a])}return t},t.prototype.adjustUroko2=function(t){for(var e=[],r=0,n=t;r<n.length;r++){1===(h=(s=n[r]).stroke).a1_100&&0===h.a1_opt&&h.y1===h.y2?e.push({stroke:h,adjStroke:s,isTarget:0===h.a3_100&&0===h.a3_opt&&0===s.urokoAdjustment,y:h.y1,x1:h.x1,x2:h.x2}):3===h.a1_100&&0===h.a1_opt&&h.y2===h.y3&&e.push({stroke:h,adjStroke:s,isTarget:!1,y:h.y2,x1:h.x2,x2:h.x3})}for(var o=0,a=e;o<a.length;o++){var i=a[o],s=i.adjStroke,h=i.stroke,f=i.isTarget,k=i.y,y=i.x1,c=i.x2;if(f){for(var p=0,x=0,g=e;x<g.length;x++){var d=g[x],l=d.stroke,M=d.y,v=d.x1,_=d.x2;h!==l&&!(y+1>_||c-1<v)&&u(Math.abs(k-M))<this.kAdjustUroko2Length&&(p+=Math.pow(this.kAdjustUroko2Length-Math.abs(k-M),1.1))}s.urokoAdjustment=Math.min(Math.floor(p/this.kAdjustUroko2Length),this.kAdjustUroko2Step)}}return t},t.prototype.adjustKirikuchi=function(t){for(var e=[],r=0,n=t;r<n.length;r++){var o=n[r].stroke;1===o.a1_100&&0===o.a1_opt&&o.y1===o.y2&&e.push({y:o.y1,x1:o.x1,x2:o.x2})}for(var a=function(t){var r=t.stroke;2===r.a1_100&&0===r.a1_opt&&32===r.a2_100&&0===r.a2_opt&&r.x1>r.x2&&r.y1<r.y2&&e.some((function(t){var e=t.y,n=t.x1,o=t.x2;return n<r.x1&&o>r.x1&&e===r.y1}))&&(t.kirikuchiAdjustment=1)},i=0,s=t;i<s.length;i++){a(s[i])}return t},t}(),W=function(t,e){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},W(t,e)};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function A(t,e,r,o,a,i,s,h,f,k,y,c){var p=0;if(0!==p){var x=r===a&&o===i?[0,p]:n([r-a,o-i],p);r+=x[0],o+=x[1]}var g=0;if(0!==g){var M=s===f&&h===k?[0,-g]:n([f-s,k-h],g);f+=M[0],k+=M[1]}for(var v=d(r,o,a,i,s,h,f,k,t.kRate,(function(){return t.kWidth}),(function(t,e){var r=t[0],o=t[1];return 0===u(r)&&0===u(o)?[-e,0]:n([r,o],e)})),_=v.left,j=v.right,m=new l,P=new l,w=0,W=_;w<W.length;w++){var A=W[w],b=A[0],Y=A[1];m.push(b,Y)}for(var S=0,U=j;S<U.length;S++){var L=U[S];b=L[0],Y=L[1];P.push(b,Y)}P.reverse(),m.concat(P),e.push(m)}function b(t,e,r,n,o,a,i,s,h,u,f,k){A(t,e,r,n,o,a,i,s,h,u)}function Y(t,e,r,n,o,a,i,s,h,u){A(t,e,r,n,o,a,o,a,i,s)}function S(t,e,r,n,o,a,i,s){var h,u,f,k,y,c;r===o&&n>a||r>o?(h=o,u=a,f=r,k=n,y=s,c=i):(h=r,u=n,f=o,k=a,y=i,c=s);var p=new M(h,u),x=new M(f,k);switch(h===f&&u===k||(p.setDown(f,k),x.setUp(h,u)),y%10){case 2:p.move(0,-t.kWidth);break;case 3:p.move(0,-t.kWidth*t.kKakato)}switch(c%10){case 2:x.move(0,t.kWidth);break;case 3:x.move(0,t.kWidth*t.kKakato)}var g=new l([p.getPoint(t.kWidth,0),x.getPoint(t.kWidth,0),x.getPoint(-t.kWidth,0),p.getPoint(-t.kWidth,0)]);r===o&&g.reverse(),e.push(g)}var U=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.shotai=c.kGothic,e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}W(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e.prototype.getDrawers=function(t){var e=this;return this.adjustStrokes(t).map((function(t){return function(r){!function(t,e,r){var o=r.stroke,a=o.a1_100,i=o.a2_100,s=o.a3_100,h=o.a3_opt,u=o.a3_opt_1,f=o.a3_opt_2,k=o.x1,y=o.y1,c=o.x2,p=o.y2,x=o.x3,g=o.y3,d=o.x4,l=o.y4,M=r.haneAdjustment,v=r.mageAdjustment;switch(a){case 0:break;case 1:if(4===s&&0===M&&0===f){var _=k===c&&y===p?[0,t.kMage]:n([k-c,y-p],t.kMage);S(t,e,k,y,A=c+_[0],m=p+_[1],i,1),Y(t,e,A,m,c,p,c-2*t.kMage,p-.5*t.kMage)}else S(t,e,k,y,c,p,i,s);break;case 2:case 12:if(4===s&&0===M&&0===f){var j=c===x?[0,-t.kMage]:p===g?[-t.kMage,0]:n([c-x,p-g],t.kMage);Y(t,e,k,y,c,p,A=x+j[0],m=g+j[1]),Y(t,e,A,m,x,g,x-2*t.kMage,g-.5*t.kMage)}else if(5===s&&0===h){var m=g,P=(A=x+t.kMage)+.5*t.kMage,w=g-2*t.kMage;Y(t,e,k,y,c,p,x,g),Y(t,e,x,g,A,m,P,w)}else Y(t,e,k,y,c,p,x,g);break;case 3:var W=k===c&&y===p?[0,t.kMage]:n([k-c,y-p],t.kMage),A=c+W[0],U=(m=p+W[1],c===x&&p===g?[0,-t.kMage]:n([x-c,g-p],t.kMage));if(P=c+U[0],w=p+U[1],S(t,e,k,y,A,m,i,1),Y(t,e,A,m,c,p,P,w),5===s&&0===u&&0===v){var L=x-t.kMage,K=g,T=x+.5*t.kMage,R=g-2*t.kMage;S(t,e,P,w,L,K,1,1),Y(t,e,L,K,x,g,T,R)}else S(t,e,P,w,x,g,1,s);break;case 6:5===s&&0===h?(A=d-t.kMage,m=l,P=d+.5*t.kMage,w=l-2*t.kMage,b(t,e,k,y,c,p,x,g,A,m),Y(t,e,A,m,d,l,P,w)):b(t,e,k,y,c,p,x,g,d,l);break;case 7:S(t,e,k,y,c,p,i,1),Y(t,e,c,p,x,g,d,l)}}(e,r,t)}}))},e}(w);function L(t){return t===c.kMincho?new w:new U}return function(){function r(e){this.kMincho=c.kMincho,this.kGothic=c.kGothic,this.kFont=L(c.kMincho),this.stretch=y,this.kFont.setSize(e),this.kBuhin=new t}return Object.defineProperty(r.prototype,"kShotai",{get:function(){return this.kFont.shotai},set:function(t){this.kFont=L(t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"kUseCurve",{get:function(){return this.kFont.kUseCurve},set:function(t){this.kFont.kUseCurve=t},enumerable:!1,configurable:!0}),r.prototype.makeGlyph=function(t,e){var r=this.kBuhin.search(e);this.makeGlyph2(t,r)},r.prototype.makeGlyph2=function(t,e){if(""!==e)for(var r=this.getEachStrokes(e),n=0,o=this.kFont.getDrawers(r);n<o.length;n++){(0,o[n])(t)}},r.prototype.makeGlyph3=function(t){var r=[];if(""!==t)for(var n=this.getEachStrokes(t),o=0,a=this.kFont.getDrawers(n);o<a.length;o++){var i=a[o],s=new e;i(s),r.push(s)}return r},r.prototype.makeGlyphSeparated=function(t){var r=this,n=t.map((function(t){return r.getEachStrokes(t)})),o=this.kFont.getDrawers(n.reduce((function(t,e){return t.concat(e)}),[])),a=new e,i=0;return n.map((function(t){for(var r=t.length,n=a.array.length,s=0,h=o.slice(i,i+r);s<h.length;s++){(0,h[s])(a)}i+=r;var u=new e;return u.array=a.array.slice(n),u}))},r.prototype.getEachStrokes=function(t){for(var e=[],r=0,n=t.split("$");r<n.length;r++){var o=n[r].split(":");if(99!==Math.floor(+o[0]))e.push(new p([Math.floor(+o[0]),Math.floor(+o[1]),Math.floor(+o[2]),Math.floor(+o[3]),Math.floor(+o[4]),Math.floor(+o[5]),Math.floor(+o[6]),Math.floor(+o[7]),Math.floor(+o[8]),Math.floor(+o[9]),Math.floor(+o[10])]));else{var a=this.kBuhin.search(o[7]);""!==a&&(e=e.concat(this.getEachStrokesOfBuhin(a,Math.floor(+o[3]),Math.floor(+o[4]),Math.floor(+o[5]),Math.floor(+o[6]),Math.floor(+o[1]),Math.floor(+o[2]),Math.floor(+o[9]),Math.floor(+o[10]))))}}return e},r.prototype.getEachStrokesOfBuhin=function(t,e,r,n,o,a,i,s,h){var u=this.getEachStrokes(t),f=this.getBox(u);0===a&&0===i||(a>100?a-=200:(s=0,h=0));for(var k=0,y=u;k<y.length;k++){var c=y[k];0===a&&0===i||c.stretch(a,s,i,h,f.minX,f.maxX,f.minY,f.maxY),c.x1=e+c.x1*(n-e)/200,c.y1=r+c.y1*(o-r)/200,c.x2=e+c.x2*(n-e)/200,c.y2=r+c.y2*(o-r)/200,c.x3=e+c.x3*(n-e)/200,c.y3=r+c.y3*(o-r)/200,c.x4=e+c.x4*(n-e)/200,c.y4=r+c.y4*(o-r)/200}return u},r.prototype.getBox=function(t){for(var e=200,r=200,n=0,o=0,a=0,i=t;a<i.length;a++){var s=i[a].getBox(),h=s.minX,u=s.maxX,f=s.minY,k=s.maxY;e=Math.min(e,h),n=Math.max(n,u),r=Math.min(r,f),o=Math.max(o,k)}return{minX:e,maxX:n,minY:r,maxY:o}},r.Buhin=t,r.Polygons=e,r}()}();
